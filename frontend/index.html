<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Улучшение изображений с ИИ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Arial', sans-serif; }
        body { background: #1a0a0f; color: #ffd6e7; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: #2e0f1a; padding: 30px; border-radius: 15px; border: 1px solid #ff69b4; }
        h1 { text-align: center; color: #ff85c0; margin-bottom: 25px; }
        .drop-area { border: 2px dashed #ff69b4; border-radius: 12px; padding: 40px; text-align: center; cursor: pointer; background: rgba(255, 105, 180, 0.05); }
        .btn { background: linear-gradient(135deg, #ff69b4, #ff1493); color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; margin: 10px; }
        .preview-container { display: flex; gap: 20px; margin-top: 20px; }
        .image-box { flex: 1; border: 1px solid #ff69b4; padding: 15px; border-radius: 10px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Улучшение изображений с ИИ</h1>
        <div class="drop-area" id="dropArea">
            <p>Перетащите сюда изображение или</p>
            <button class="btn" id="selectBtn">Выбрать файл</button>
            <input type="file" id="fileInput" accept="image/*" style="display: none;">
        </div>
        
        <div id="options" class="hidden">
            <button id="processBtn" class="btn">Улучшить с ИИ</button>
        </div>
        
        <div id="loading" class="hidden">
            <p>Обработка изображения...</p>
        </div>
        
        <div class="preview-container hidden" id="preview">
            <div class="image-box">
                <h3>Оригинал</h3>
                <img id="originalImg" style="max-width: 100%;">
            </div>
            <div class="image-box">
                <h3>Результат</h3>
                <img id="resultImg" style="max-width: 100%;">
                <button id="downloadBtn" class="btn">Скачать</button>
            </div>
        </div>
    </div>

    <script>
        // Элементы DOM
        const dropArea = document.getElementById('dropArea');
        const fileInput = document.getElementById('fileInput');
        const selectBtn = document.getElementById('selectBtn');
        const optionsDiv = document.getElementById('options');
        const processBtn = document.getElementById('processBtn');
        const loadingDiv = document.getElementById('loading');
        const previewDiv = document.getElementById('preview');
        const originalImg = document.getElementById('originalImg');
        const resultImg = document.getElementById('resultImg');
        const downloadBtn = document.getElementById('downloadBtn');
        
        let selectedFile = null;

        // Обработчики событий
        selectBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileSelect);
        dropArea.addEventListener('dragover', (e) => e.preventDefault());
        dropArea.addEventListener('drop', handleDrop);
        processBtn.addEventListener('click', processImage);
        downloadBtn.addEventListener('click', downloadResult);

        // Функции
        function handleFileSelect(e) {
            selectedFile = e.target.files[0];
            showPreview(selectedFile);
        }

        function handleDrop(e) {
            e.preventDefault();
            selectedFile = e.dataTransfer.files[0];
            showPreview(selectedFile);
        }

        function showPreview(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                originalImg.src = e.target.result;
                optionsDiv.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }

        async function processImage() {
            if (!selectedFile) return;
            
            loadingDiv.classList.remove('hidden');
            optionsDiv.classList.add('hidden');
            
            const reader = new FileReader();
            reader.onload = async (e) => {
                // Отправка на сервер Netlify
                const base64Image = e.target.result.split(',')[1];
                const response = await fetch('/.netlify/functions/enhance', {
                    method: 'POST',
                    body: JSON.stringify({ image: base64Image }),
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                resultImg.src = `data:image/jpeg;base64,${data.image}`;
                
                loadingDiv.classList.add('hidden');
                previewDiv.classList.remove('hidden');
            };
            reader.readAsDataURL(selectedFile);
        }

        function downloadResult() {
            const link = document.createElement('a');
            link.href = resultImg.src;
            link.download = 'enhanced_' + selectedFile.name;
            link.click();
        }
    </script>
</body>
</html>
